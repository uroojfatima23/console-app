# Research: Next.js Frontend Implementation

**Date**: 2026-01-08

## Decisions

### 1. Authentication Architecture

**Decision**: Use "Better Auth" with a BFF (Backend for Frontend) pattern where Next.js handles session management via secure cookies and proxies API requests to the FastAPI backend, attaching the Bearer token server-side.

**Rationale**:
- **Security**: Storing tokens in HTTP-only cookies prevents XSS attacks compared to localStorage.
- **Simplification**: Next.js App Router middleware can easily protect routes without client-side flickering.
- **Interoperability**: FastAPI can verify the JWT tokens generated by Better Auth.

**Alternatives Considered**:
- *Client-side only (localStorage)*: Rejected due to security risks (XSS) and complexity in handling token refresh.
- *NextAuth.js*: Rejected in favor of Better Auth as per project constraints/requirements.

### 2. Service Layer Pattern

**Decision**: Implement a strongly-typed Service Layer in `src/services/` using native `fetch`.

**Rationale**:
- **Decoupling**: UI components remain agnostic of the underlying API implementation.
- **Maintainability**: Centralized error handling and type definitions.
- **Future-proofing**: Easy to swap the backend URL or implementation details without touching UI code.

**Alternatives Considered**:
- *Direct fetch in components*: Rejected because it leads to code duplication and makes testing harder.
- *TanStack Query (React Query)*: While powerful, a simple service layer is sufficient for the current scope and keeps the bundle size smaller. Can be added later if complex caching is needed.

### 3. Testing Stack

**Decision**: Use **Vitest** + **React Testing Library**.

**Rationale**:
- **Performance**: Vitest is significantly faster than Jest in Vite/Next.js environments.
- **Compatibility**: First-class support in modern Next.js templates.
- **DX**: Watch mode and configuration is simpler than Jest.

**Alternatives Considered**:
- *Jest*: Slower and requires more configuration for modern TS/Next.js features.

### 4. Folder Structure

**Decision**: Validated the proposed structure:
```
frontend/
├── src/
│   ├── app/
│   ├── components/
│   ├── services/
│   ├── lib/
│   ├── styles/
│   └── types/
```

**Rationale**:
- Follows Next.js App Router conventions (`src/app`).
- Clear separation of concerns (`components` vs `services` vs `lib`).
